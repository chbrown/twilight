#!/usr/bin/env node
/*jslint node: true */
var logger = require('loge');

var optimist = require('optimist')
  .usage([
    'Usage: twilight <command> [<args>]',
    '',
    'commands:',
    '  stream         Call one of the Twitter Streaming API endpoints',
    '  rest           Call one of the Twitter REST API endpoints',
    '  users          Get user info from stream of screen names or user IDs',
    '  statuses       Get full status payloads from stream of status IDs',
  ].join('\n'))
  .describe({
    help: 'print this help message',
    verbose: 'print extra output',
    version: 'print version',
  })
  .alias({help: 'h', verbose: 'v'})
  .boolean(['help', 'verbose']);

var argv = optimist.argv;
logger.level = argv.verbose ? 'debug' : 'info';

if (argv.help) {
  optimist.showHelp();
}
else if (argv.version) {
  console.log(require('../package').version);
}
else {
  var commands = {
    stream: require('./commands/stream'),
    rest: require('./commands/rest'),
    users: require('./commands/users'),
    statuses: require('./commands/statuses'),
  };

  argv = optimist.check(function(argv) {
    if (argv._.length < 1) {
      throw new Error('You must specify a command');
    }
    if (commands[argv._[0]] === undefined) {
      throw new Error('Unrecognized command: ' + argv._[0]);
    }
  }).argv;

  commands[argv._[0]](argv);
}

process.on('SIGINT', function() {
  console.error('Ctrl+C :: SIGINT!');
  process.exit(130);
});
